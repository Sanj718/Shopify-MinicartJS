class MiniCart{constructor(cartEndpoint){this.cartEndpoint=cartEndpoint||"/cart.js",this.minicart=document.querySelector("[data-minicart]"),this.items=document.querySelector("[data-minicart-items]"),this.item="data-minicart-item",this.close="data-minicart-close",this.open="data-minicart-open",this.plus="data-minicart-plus",this.minus="data-minicart-minus",this.count="data-minicart-count",this.totalCount=document.querySelector("[data-minicart-totalCount]"),this.remove="data-minicart-remove",this.subtotal=document.querySelector("[data-minicart-subtotal]")}openCart(target){this.minicart&&target.hasAttribute(this.open)&&(this.minicart.classList.add("open"),this.minicart.classList.remove("close"))}closeCart(target){this.minicart&&target.hasAttribute(this.close)&&(this.minicart.classList.remove("open"),this.minicart.classList.add("close"))}updatTotalCount(total){if(!total)return!1;this.totalCount&&(this.totalCount.innerHTML=total)}updateSubtotal(total){if(!total)return!1;this.subtotal&&(this.subtotal.innerHTML=this.moneyFormat(total))}updateCart(openCart=!0){fetch(this.cartEndpoint).then(resp=>resp.json()).then(cart=>{if(cart){this.updateSubtotal(cart.total_price),this.updatTotalCount(cart.item_count);let allItems="";for(let item of cart.items)allItems+=this.cartItemHTML(item);this.items&&(this.items.innerHTML=allItems),cart.items.length<1?this.isEmpty():this.isFilled(openCart)}}).catch(error=>{console.error(error)})}isFilled(openCart=!0){this.minicart&&(this.minicart.classList.remove("empty"),openCart&&(this.minicart.classList.add("open"),this.minicart.classList.remove("open")))}isEmpty(){this.minicart&&this.minicart.classList.add("empty")}removeCartItem(target){if(target.hasAttribute(this.remove)){const id=this.findAncestor(target,`[${this.item}]`)&&this.findAncestor(target,`[${this.item}]`).dataset.minicartItem;id&&fetch("/cart/change.js",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:id,quantity:0})}).then(resp=>resp.json()).then(cart=>{this.updateCart()}).catch(error=>{console.error(error)})}}minusCartItem(target){if(target.hasAttribute(this.minus)){const id=this.findAncestor(target,`[${this.item}]`)&&this.findAncestor(target,`[${this.item}]`).dataset.minicartItem,quantityPicker=target.parentNode,countElem=quantityPicker.querySelector(`[${this.count}]`),newQuantity=countElem.value-1;id&&newQuantity&&fetch("/cart/change.js",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`quantity=&id=`}).then(()=>{this.updateCart()}).catch(error=>{console.error("Error:",error)})}}plusCartItem(target){if(target.hasAttribute(this.plus)){const id=this.findAncestor(target,`[${this.item}]`)&&this.findAncestor(target,`[${this.item}]`).dataset.minicartItem,quantityPicker=target.parentNode;id&&fetch("/cart/add.js",{method:"post",headers:{"x-requested-with":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"},body:`id=&quantity=1`}).then(resp=>resp.json()).then(data=>{422===data.status||this.updateCart()}).catch(error=>{console.error("Error:",error)})}}cartItemHTML(item){function buildProps(item){if(!item||!item.properties||0===Object.keys(item.properties).length)return"";let result="";for(const[key,value]of Object.entries(item.properties))result+=`<li>: </li>`;return result}function buildOptions(item){if(!item||!item.options_with_values||0===item.options_with_values.length)return"";let result="";for(let option of item.options_with_values)"Default Title"!==option.value&&(result+=`<li>${option.name}: ${option.value}</li>`);return result}function getImage(image,size=300){if(!image)return"";const ext=image.match(/\.(?:jpg|gif|png)/g);return image.replace(ext[0],`_x`+ext[0])}function buildImage(item){return item?`<img alt="" class="responsive-image__image lazyload" data-sizes="auto" src="${getImage(item.image,30)}" data-src="${getImage(item.image,250)}">`:""}let cartItem=miniCartItem;return cartItem&&(cartItem=cartItem.replace(/{{itemImage}}/g,buildImage(item)),cartItem=cartItem.replace(/{{itemVariantId}}/g,item.id),cartItem=cartItem.replace(/{{itemTitle}}/g,item.product_title),cartItem=cartItem.replace(/{{itemUrl}}/g,item.url),cartItem=cartItem.replace(/{{itemComparePrice}}/g,item.original_price>item.price?this.moneyFormat(item.original_price):""),cartItem=cartItem.replace(/{{itemPrice}}/g,this.moneyFormat(item.price)),cartItem=cartItem.replace(/{{itemOptions}}/g,buildOptions(item)),cartItem=cartItem.replace(/{{itemProps}}/g,buildProps(item)),cartItem=cartItem.replace(/{{itemQuantity}}/g,item.quantity)),cartItem}hideOnEscape(e){var keyCode;27===e.keyCode&&this.minicart&&(this.minicart.classList.remove("open"),this.minicart.classList.add("close"))}moneyFormat(amout,customCurrency="$"){if(!amout)return"";if("function"==typeof Shopify.formatMoney){const currency=Shopify.money_format.split("{")[0];return Shopify.formatMoney(amout,`{{amount_no_decimals}}`)}{const currency=customCurrency;return`${amout/100}`}}findAncestor(el,sel){for(;(el=el.parentElement)&&!(el.matches||el.matchesSelector).call(el,sel););return el}}const mini_cart=new MiniCart;window.mini_cart=mini_cart,mini_cart.updateCart(!1),document.addEventListener("keydown",(function(e){mini_cart.hideOnEscape(e)})),document.addEventListener("click",(function(e){mini_cart.openCart(e.target),mini_cart.removeCartItem(e.target),mini_cart.plusCartItem(e.target),mini_cart.minusCartItem(e.target),mini_cart.closeCart(e.target)}));